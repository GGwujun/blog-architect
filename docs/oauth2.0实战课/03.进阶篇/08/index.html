<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-architect/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-architect";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>14 | 查漏补缺：OAuth 2.0 常见问题答疑 - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/oauth2.0实战课/03.进阶篇/08" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-architect/spark性能调优实战">spark性能调优实战</a></li></ul></span><span>架构师<ul><li><a href="/blog-architect/设计模式之美">设计模式之美</a></li><li><a href="/blog-architect/架构实战案例解析">架构实战案例解析</a></li><li><a href="/blog-architect/许式伟的架构课">许式伟的架构课</a></li><li><a href="/blog-architect/说透中台">说透中台</a></li><li><a aria-current="page" class="active" href="/blog-architect/oauth2.0实战课">oauth2.0实战课</a></li><li><a href="/blog-architect/从0开始学架构">从0开始学架构</a></li><li><a href="/blog-architect/即时消息技术剖析与实战">即时消息技术剖析与实战</a></li><li><a href="/blog-architect/如何设计一个秒杀系统">如何设计一个秒杀系统</a></li><li><a href="/blog-architect/如何落地业务建模">如何落地业务建模</a></li><li><a href="/blog-architect/性能优化高手课">性能优化高手课</a></li><li><a href="/blog-architect/性能工程高手课">性能工程高手课</a></li><li><a href="/blog-architect/手把手带你搭建秒杀系统">手把手带你搭建秒杀系统</a></li><li><a href="/blog-architect/技术与商业案例解读">技术与商业案例解读</a></li><li><a href="/blog-architect/推荐系统三十六式">推荐系统三十六式</a></li><li><a href="/blog-architect/检索技术核心20讲">检索技术核心20讲</a></li><li><a href="/blog-architect/软件设计之美">软件设计之美</a></li><li><a href="/blog-architect/高并发系统设计40问">高并发系统设计40问</a></li><li><a href="/blog-architect/高楼的性能工程实战课">高楼的性能工程实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-architect/spark性能调优实战">spark性能调优实战</a></li></ul></li><li>架构师<ul><li><a href="/blog-architect/设计模式之美">设计模式之美</a></li><li><a href="/blog-architect/架构实战案例解析">架构实战案例解析</a></li><li><a href="/blog-architect/许式伟的架构课">许式伟的架构课</a></li><li><a href="/blog-architect/说透中台">说透中台</a></li><li><a aria-current="page" class="active" href="/blog-architect/oauth2.0实战课">oauth2.0实战课</a></li><li><a href="/blog-architect/从0开始学架构">从0开始学架构</a></li><li><a href="/blog-architect/即时消息技术剖析与实战">即时消息技术剖析与实战</a></li><li><a href="/blog-architect/如何设计一个秒杀系统">如何设计一个秒杀系统</a></li><li><a href="/blog-architect/如何落地业务建模">如何落地业务建模</a></li><li><a href="/blog-architect/性能优化高手课">性能优化高手课</a></li><li><a href="/blog-architect/性能工程高手课">性能工程高手课</a></li><li><a href="/blog-architect/手把手带你搭建秒杀系统">手把手带你搭建秒杀系统</a></li><li><a href="/blog-architect/技术与商业案例解读">技术与商业案例解读</a></li><li><a href="/blog-architect/推荐系统三十六式">推荐系统三十六式</a></li><li><a href="/blog-architect/检索技术核心20讲">检索技术核心20讲</a></li><li><a href="/blog-architect/软件设计之美">软件设计之美</a></li><li><a href="/blog-architect/高并发系统设计40问">高并发系统设计40问</a></li><li><a href="/blog-architect/高楼的性能工程实战课">高楼的性能工程实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-architect/oauth2.0实战课">oauth2.0实战课</a></li><li><a href="/blog-architect/oauth2.0实战课/01.开篇词">01.开篇词</a><ul><li><a href="/blog-architect/oauth2.0实战课/01.开篇词/01"><span>开篇词 | 为什么要学OAuth 2.0？</span></a></li></ul></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇">02.基础篇</a><ul><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/01"><span>01 | OAuth 2.0是要通过什么方式解决什么问题？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/02"><span>02 | 授权码许可类型中，为什么一定要有授权码？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/03"><span>03 | 授权服务：授权码和访问令牌的颁发流程是怎样的？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/04"><span>04 | 在OAuth 2.0中，如何使用JWT结构化令牌？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/05"><span>05 | 如何安全、快速地接入OAuth 2.0？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/02.基础篇/06"><span>06 | 除了授权码许可类型，OAuth 2.0还支持什么授权流程？</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-architect/oauth2.0实战课/03.进阶篇">03.进阶篇</a><ul><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/01"><span>07 | 如何在移动App中使用OAuth 2.0？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/02"><span>08 | 实践OAuth 2.0时，使用不当可能会导致哪些安全漏洞？</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/03"><span>09 | 实战：利用OAuth 2.0实现一个OpenID Connect用户身份认证协议</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/04"><span>10 | 串讲：OAuth 2.0的工作流程与安全问题</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/05"><span>11 | 实战案例：使用Spring Security搭建一套基于JWT的OAuth 2.0架构</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/06"><span>12 | 架构案例：基于OAuth 2.0/JWT的微服务参考架构</span></a></li><li><a href="/blog-architect/oauth2.0实战课/03.进阶篇/07"><span>13 | 各大开放平台是如何使用OAuth 2.0的？</span></a></li><li><a aria-current="page" class="active" href="/blog-architect/oauth2.0实战课/03.进阶篇/08"><span>14 | 查漏补缺：OAuth 2.0 常见问题答疑</span></a></li></ul></li><li><a href="/blog-architect/oauth2.0实战课/04.结束语">04.结束语</a><ul><li><a href="/blog-architect/oauth2.0实战课/04.结束语/01"><span>期末测试 | 一套习题，测试你的掌握程度</span></a></li><li><a href="/blog-architect/oauth2.0实战课/04.结束语/02"><span>结束语 | 把学习当成一种习惯</span></a></li></ul></li><li><a href="/blog-architect/oauth2.0实战课/summary">oauth2.0实战课</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="发明 OAuth 的目的到底是什么？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#发明-oauth-的目的到底是什么"><span>发明 OAuth 的目的到底是什么？</span></a></li><li title="OAuth 2.0 是身份认证协议吗？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#oauth-20-是身份认证协议吗"><span>OAuth 2.0 是身份认证协议吗？</span></a></li><li title="有了刷新令牌，是不是就可以让访问令牌一直有效了？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#有了刷新令牌是不是就可以让访问令牌一直有效了"><span>有了刷新令牌，是不是就可以让访问令牌一直有效了？</span></a></li><li title="使用了HTTPS，是不是就能确保JWT格式令牌的数据安全？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#使用了https是不是就能确保jwt格式令牌的数据安全"><span>使用了HTTPS，是不是就能确保JWT格式令牌的数据安全？</span></a></li><li title="ID令牌和访问令牌之间有联系吗？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#id令牌和访问令牌之间有联系吗"><span>ID令牌和访问令牌之间有联系吗？</span></a></li><li title="PKCE协议到底解决的是什么问题？" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#pkce协议到底解决的是什么问题"><span>PKCE协议到底解决的是什么问题？</span></a></li><li title="总结" data-depth="2"><a href="/blog-architect/oauth2.0实战课/03.进阶篇/08#总结"><span>总结</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="14--查漏补缺oauth-20-常见问题答疑"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#14--查漏补缺oauth-20-常见问题答疑"><span class="icon icon-link"></span></a>14 | 查漏补缺：OAuth 2.0 常见问题答疑</h1><p>你好，我是王新栋。</p><p>从6月29日这门课上线，到现在已经过去一个多月了。我看到了很多同学的留言，有思考，也有提出的问题。那我首先，在这里要感谢你对咱们这门课的支持、鼓励和反馈。</p><p>在回复你们的留言时，我也把你们提出的问题记了下来。在梳理今天这期答疑的时候，我又从头到尾看了一遍这些问题，也进一步思考了每个问题背后的元认知，最后我归纳出了6个问题：</p><ol><li>发明 OAuth 的目的到底是什么？</li><li>OAuth 2.0 是身份认证协议吗？</li><li>有了刷新令牌，是不是就可以让访问令牌一直有效了？</li><li>使用了HTTPS，是不是就能确保JWT格式令牌的数据安全？</li><li>ID令牌和访问令牌之间有联系吗？</li><li>PKCE协议到底解决的是什么问题？</li></ol><p>接下来，我们就一一看看这些问题吧。</p><h2 id="发明-oauth-的目的到底是什么"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#发明-oauth-的目的到底是什么"><span class="icon icon-link"></span></a>发明 OAuth 的目的到底是什么？</h2><p>OAuth 协议的设计初衷，就是让最终用户也就是资源拥有者（小明），将他们在受保护资源服务器（京东商家开放平台）上的部分权限（查询当天订单）<strong>委托</strong>给第三方应用（小兔打单软件），使得第三方应用（小兔）能够代表最终用户（小明）执行操作（查询当天订单）。</p><p>这便是OAuth 协议设计的目的。在OAuth 协议中，通过为<strong>每个第三方软件和每个用户的组合</strong>分别生成对受保护资源具有<strong>受限的访问权限的凭据，也就是访问令牌</strong>，来代替之前的用户名和密码。<strong>而生成访问令牌之前的登录操作，又是在用户跟平台之间进行的，第三方软件根本无从得知用户的任何信息。</strong></p><p>这样第三方软件的逻辑处理就大大简化了，它今后的动作就变成了请求访问令牌、使用访问令牌、访问受保护资源，同时在第三方软件调用大量API的时候，<strong>不再传输用户名和密码，从而减少了网络安全的攻击面。</strong></p><p>从安全的角度来讲，<strong>为每个第三方软件和每个用户的组合来生成一个访问令牌</strong>的方式，可以减少对平台更多用户造成的危害。因为这样一来，单个第三方软件被攻破而带来的危害，仅仅会让这一个第三方软件的用户受到影响。</p><p>那么有的同学就要会问了，这样攻击的对象就会转移到授权服务身上。这个想法没错，但保护一个授权服务肯定要比保护成千上万个、由不同研发人员开发的第三方软件容易得多。</p><h2 id="oauth-20-是身份认证协议吗"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#oauth-20-是身份认证协议吗"><span class="icon icon-link"></span></a>OAuth 2.0 是身份认证协议吗？</h2><p>在这门课中，我其实一直在强调，**OAuth 2.0 是一种授权协议，“它一心只专注于干好授权这件事儿”，OAuth 2.0 不是身份认证协议。**但实际上，我在刚开始学习 OAuth 2.0 的时候，也曾错误地认为它是身份认证协议。</p><p>因为我当时觉得，有用户参与其中，比如小明在使用小兔打单软件之前，要向授权服务进行登录操作从而进行身份认证 ，那OAuth 2.0就应该是一个身份认证协议啊。</p><p>但是，小明必须登录之后才能进行授权，是一个额外的需求，登录跟授权体系是独立的。虽然登录操作看似“内嵌”在了 OAuth 2.0 的流程中，但生产环境中登录和授权还是两套独立存在的系统。所以说，<strong>像这种“内嵌”的身份认证行为，并不是说 OAuth 2.0 自身承担起了身份认证协议的责任。</strong></p><p>同时，身份认证会告诉第三方软件当前的用户是谁，但实际上OAuth 2.0 自始至终都没有向第三方软件透露过关于用户的任何信息。这一点，我们在讲发明OAuth协议的目的时也提到过。我们可以再想想小兔打单软件的例子，看是不是这样：小兔打单软件永远也不会知道小明的任何信息，它仅仅是请求访问令牌，使用访问令牌并最终调用查询订单的API。</p><h2 id="有了刷新令牌是不是就可以让访问令牌一直有效了"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#有了刷新令牌是不是就可以让访问令牌一直有效了"><span class="icon icon-link"></span></a>有了刷新令牌，是不是就可以让访问令牌一直有效了？</h2><p>要回答这个问题，我们先复习下访问令牌和刷新令牌相关的几个知识点吧。</p><p>第一，OAuth 2.0的核心是授权，授权的核心是令牌，也就是我们说的访问令牌。</p><p>第二，在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/257101">第3讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中我们提到，为了提高用户的体验，OAuth 2.0提供了刷新令牌的机制，使得访问令牌过期后，第三方软件在无需用户再次授权的情况下，可以重新请求一个访问令牌。</p><p>第三，在使用上，<strong>刷新令牌只能用在授权服务上，而访问令牌只能用在受保护资源服务上。</strong></p><p>有了这些知识做基础，我们可以继续分析“有了刷新令牌，是不是就可以让访问令牌一直有效”这个问题了。</p><p>当访问令牌被 “递给” 受保护资源服务的时候，受保护资源服务需要对访问令牌进行验证，还要对访问令牌关联的权限和第三方软件的请求进行权限匹配校验。当访问令牌过期的时候，我们使用刷新令牌请求到的访问令牌，是授权服务重新生成的，而不是延长了原访问令牌的有效期。</p><p>当前的这个刷新令牌被使用之后，授权服务可以自行决定是颁发一个新的刷新令牌，还是仍然给第三方软件返回上一个刷新令牌。安全起见，我们的建议是<strong>返回一个新的刷新令牌</strong>。这时，你可能就有一个疑问了：第三方软件已经换了一个访问令牌了，刷新令牌又一直存在，那是不是就可以一直使用刷新令牌来获取访问令牌了呢？</p><p>要解决这个疑问，我们要知道的是，**刷新令牌也有有效期。**尽管生成了新的刷新令牌，但它的有效期不会改变，有效期的时间戳仍然是上一个刷新令牌的。刷新令牌的有效期到了，就不能再继续用它来申请新的访问令牌了。</p><h2 id="使用了https是不是就能确保jwt格式令牌的数据安全"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#使用了https是不是就能确保jwt格式令牌的数据安全"><span class="icon icon-link"></span></a>使用了HTTPS，是不是就能确保JWT格式令牌的数据安全？</h2><p>OAuth 2.0 的使用从来都不应该脱离HTTPS。因为访问令牌、应用密钥敏感信息要在网络上传输，都离不开HTTPS的保护。但是，HTTPS也只是保证了访问令牌等重要信息在网络传输上的安全。</p><p>在OAuth 2.0 的规范中，访问令牌对第三方软件是不透明的，从来都不应该被任何第三方软件解析到。由于JWT格式的令牌自包含了用户相关的信息，比如用户标识，因此仅仅对它进行签名还不够。要避免第三方软件有机会获取访问令牌所包含的信息，那我们在与第三方软件交互的环境下使用JWT格式的令牌时，还要对它进行加密来保障令牌的安全，而不是仅仅依靠HTTPS。</p><h2 id="id令牌和访问令牌之间有联系吗"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#id令牌和访问令牌之间有联系吗"><span class="icon icon-link"></span></a>ID令牌和访问令牌之间有联系吗？</h2><p>在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/262672">第9讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，我们在用OAuth 2.0 实现一个 OpenID Connect身份认证协议的时候，讲到了ID令牌。在这一讲的后面，有同学还是不太清楚ID令牌和访问令牌是啥关系，当时我就在留言区做了回复。现在，我重新整理了思路再和你解释一下，因为认识到ID令牌和访问令牌的联系与区别，对我们利用OAuth 2.0 搭建一个身份认证协议来说太重要了。</p><p>我们先来总结下ID令牌和访问令牌的作用：</p><ul><li>ID令牌，也就是ID_TOKEN，代表的是用户身份令牌，可以说是一个单独的身份认证结果，永远不会像访问令牌那样作为一个参数，去传递给其它外部服务；</li><li>访问令牌，也就是ACCESS_TOKEN，就是一个令牌，是要被第三方软件用来作为凭证，从而代表用户去请求受保护资源服务的。</li></ul><p>你看，这两种令牌是截然不同的。接下来，我们就分析下，它们的区别都体现在哪些方面吧。</p><p>第一，ID令牌是对访问令牌的补充，而不是要替换访问令牌。之所以采用这样双令牌的方式，就是想让早先存在的访问令牌，可以在OAuth 2.0 中继续保持对第三方软件的不透明性，而让后来新增的ID令牌要能够被解析，目的就是方便应用到身份认证协议中。</p><p>第二，ID令牌和访问令牌有不同的生命周期，ID令牌的生命周期相对来说更短些。因为ID令牌的作用就是代表一个单独的身份认证结果，它的使命就是用来标识用户的。而这个标识并不是用户名，用户登录的时候用的是用户名而不是这个ID令牌，所以如果用户注销或者退出了登录，ID令牌的生命周期就随之结束了。</p><p>访问令牌可以在用户离开后的很长时间内，继续被第三方软件用来请求受保护资源服务。比如，小明使用了小兔打单软件的批量导出订单功能，如果耗时相对比较长，小明不必一直在场。</p><h2 id="pkce协议到底解决的是什么问题"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#pkce协议到底解决的是什么问题"><span class="icon icon-link"></span></a>PKCE协议到底解决的是什么问题？</h2><p>我们在<a target="_blank" rel="noopener noreferrer" href="https://time.geekbang.org/column/article/260670">第7讲<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中学习PKCE协议时，我看到了大家对这个协议的很多留言，有的是自己的思考，有的是问题的进一步讨论。我们要理解PKCE协议到底解决了什么问题，就要先看一下它被推出的背景。</p><p>2012年10月OAuth 2.0 的正式授权协议框架，也就是官方的RFC 6749被正式发布，2015年9月增补了PKCE协议，也就是官方的RFC 7636。从时间上来看，从正式发布 OAuth 2.0 授权协议到增补发布了PKCE协议，整整间隔了三年，而这三年恰恰是移动应用蓬勃发展的时期。</p><p>同时，在原生的移动客户端应用保存秘钥又存在特殊的安全问题，使用OAuth 2.0 授权码许可类型的客户端又容易受到授权码窃听的攻击。</p><p>所以，PKCE被增补发布的背景是，移动应用大力发展，同时原生客户端使用OAuth 2.0 面临着安全风险。这样我们就能理解了，发布PKCE协议的目的，主要就是缓解针对公开客户端的攻击，提高授权码使用的安全性。</p><h2 id="总结"><a aria-hidden="true" tabindex="-1" href="/blog-architect/oauth2.0实战课/03.进阶篇/08#总结"><span class="icon icon-link"></span></a>总结</h2><p>今天，我们专门用一节课来统一回答了OAuth 2.0的共性问题。我再来总结下你需要掌握的知识点：</p><ol><li>OAuth 协议被发明的目的，就是用令牌代替用户名和密码。</li><li>OAuth 2.0 不能被直接用来“从事”身份认证协议的“工作”。虽然OAuth2.0的使用要求是在HTTPS的环境下，但这并不能解决JWT令牌对第三方软件“不透明”的问题，还需要进行加密。</li><li>有了刷新令牌也不能让访问令牌一直有效下去，因为刷新令牌也有有效期。</li><li>ID令牌是对访问令牌的补充，而不是要替代访问令牌。</li><li>PKCE是OAuth 2.0的一个增补协议，主要用来缓解授权码被窃听的安全风险。</li></ol><p>或许你在学习和实践OAuth 2.0时还会遇到其他问题，但不用担心，我们的留言区一直在，我也继续在留言区等着你，来回复你关心的、遇到的问题。</p><p>欢迎你在留言区分享你的观点，也欢迎你把今天的内容分享给其他使用OAuth 2.0的朋友，我们一起精进。</p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/oauth2.0实战课/03.进阶篇/08.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 14:47:35</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-architect/umi.ded6fefd.js"></script>
  </body>
</html>
