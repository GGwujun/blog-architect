<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
    <link rel="stylesheet" href="/blog-architect/umi.3ec1f225.css" />
    <script>
      window.routerBase = "/blog-architect";
    </script>
    <script>
      //! umi version: 3.5.41
    </script>
    <script>
      !(function () {
        var e =
            navigator.cookieEnabled && void 0 !== window.localStorage
              ? localStorage.getItem("dumi:prefers-color")
              : "auto",
          o = window.matchMedia("(prefers-color-scheme: dark)").matches,
          t = ["light", "dark", "auto"];
        document.documentElement.setAttribute(
          "data-prefers-color",
          e === t[2] ? (o ? t[1] : t[0]) : t.indexOf(e) > -1 ? e : t[0]
        );
      })();
    </script>
    <title>22 | 实用的加权采样算法 - 大师兄</title>
  </head>
  <body>
    <div id="root"><div class="__dumi-default-layout" data-route="/推荐系统三十六式/09.原理篇·其他应用算法/02" data-show-sidemenu="true" data-show-slugs="true" data-site-mode="true" data-gapless="false"><div class="__dumi-default-navbar" data-mode="site"><button class="__dumi-default-navbar-toggle"></button><a class="__dumi-default-navbar-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect/">大师兄</a><nav><div class="__dumi-default-search"><input type="search" class="__dumi-default-search-input" value=""/><ul></ul></div><span>后端开发<ul><li><a href="/blog-architect/spark性能调优实战">spark性能调优实战</a></li></ul></span><span>架构师<ul><li><a href="/blog-architect/设计模式之美">设计模式之美</a></li><li><a href="/blog-architect/架构实战案例解析">架构实战案例解析</a></li><li><a href="/blog-architect/许式伟的架构课">许式伟的架构课</a></li><li><a href="/blog-architect/说透中台">说透中台</a></li><li><a href="/blog-architect/oauth2.0实战课">oauth2.0实战课</a></li><li><a href="/blog-architect/从0开始学架构">从0开始学架构</a></li><li><a href="/blog-architect/即时消息技术剖析与实战">即时消息技术剖析与实战</a></li><li><a href="/blog-architect/如何设计一个秒杀系统">如何设计一个秒杀系统</a></li><li><a href="/blog-architect/如何落地业务建模">如何落地业务建模</a></li><li><a href="/blog-architect/性能优化高手课">性能优化高手课</a></li><li><a href="/blog-architect/性能工程高手课">性能工程高手课</a></li><li><a href="/blog-architect/手把手带你搭建秒杀系统">手把手带你搭建秒杀系统</a></li><li><a href="/blog-architect/技术与商业案例解读">技术与商业案例解读</a></li><li><a aria-current="page" class="active" href="/blog-architect/推荐系统三十六式">推荐系统三十六式</a></li><li><a href="/blog-architect/检索技术核心20讲">检索技术核心20讲</a></li><li><a href="/blog-architect/软件设计之美">软件设计之美</a></li><li><a href="/blog-architect/高并发系统设计40问">高并发系统设计40问</a></li><li><a href="/blog-architect/高楼的性能工程实战课">高楼的性能工程实战课</a></li></ul></span><div class="__dumi-default-navbar-tool"><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "></div></div></div></nav></div><div class="__dumi-default-menu" data-mode="site"><div class="__dumi-default-menu-inner"><div class="__dumi-default-menu-header"><a class="__dumi-default-menu-logo" style="background-image:url(&#x27;/logo.png&#x27;)" href="/blog-architect/"></a><h1>大师兄</h1><p></p></div><div class="__dumi-default-menu-mobile-area"><ul class="__dumi-default-menu-nav-list"><li>后端开发<ul><li><a href="/blog-architect/spark性能调优实战">spark性能调优实战</a></li></ul></li><li>架构师<ul><li><a href="/blog-architect/设计模式之美">设计模式之美</a></li><li><a href="/blog-architect/架构实战案例解析">架构实战案例解析</a></li><li><a href="/blog-architect/许式伟的架构课">许式伟的架构课</a></li><li><a href="/blog-architect/说透中台">说透中台</a></li><li><a href="/blog-architect/oauth2.0实战课">oauth2.0实战课</a></li><li><a href="/blog-architect/从0开始学架构">从0开始学架构</a></li><li><a href="/blog-architect/即时消息技术剖析与实战">即时消息技术剖析与实战</a></li><li><a href="/blog-architect/如何设计一个秒杀系统">如何设计一个秒杀系统</a></li><li><a href="/blog-architect/如何落地业务建模">如何落地业务建模</a></li><li><a href="/blog-architect/性能优化高手课">性能优化高手课</a></li><li><a href="/blog-architect/性能工程高手课">性能工程高手课</a></li><li><a href="/blog-architect/手把手带你搭建秒杀系统">手把手带你搭建秒杀系统</a></li><li><a href="/blog-architect/技术与商业案例解读">技术与商业案例解读</a></li><li><a aria-current="page" class="active" href="/blog-architect/推荐系统三十六式">推荐系统三十六式</a></li><li><a href="/blog-architect/检索技术核心20讲">检索技术核心20讲</a></li><li><a href="/blog-architect/软件设计之美">软件设计之美</a></li><li><a href="/blog-architect/高并发系统设计40问">高并发系统设计40问</a></li><li><a href="/blog-architect/高楼的性能工程实战课">高楼的性能工程实战课</a></li></ul></li></ul><div class="__dumi-default-dark"><div class="__dumi-default-dark-switch "><button title="Dark theme" class="__dumi-default-dark-moon "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="3854" width="22" height="22"><path d="M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z" p-id="3855"></path></svg></button><button title="Light theme" class="__dumi-default-dark-sun "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4026" width="22" height="22"><path d="M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z" p-id="4027"></path></svg></button><button title="Default to system" class="__dumi-default-dark-auto "><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11002" width="22" height="22"><path d="M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z" p-id="11003"></path></svg></button></div></div></div><ul class="__dumi-default-menu-list"><li><a href="/blog-architect/推荐系统三十六式">推荐系统三十六式</a></li><li><a href="/blog-architect/推荐系统三十六式/01.开篇词">01.开篇词</a><ul><li><a href="/blog-architect/推荐系统三十六式/01.开篇词/01"><span>开篇词 | 用知识去对抗技术不平等</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/02.概念篇">02.概念篇</a><ul><li><a href="/blog-architect/推荐系统三十六式/02.概念篇/01"><span>01 | 你真的需要个性化推荐系统吗?</span></a></li><li><a href="/blog-architect/推荐系统三十六式/02.概念篇/02"><span>02 | 个性化推荐系统有哪些绕不开的经典问题？</span></a></li><li><a href="/blog-architect/推荐系统三十六式/02.概念篇/03"><span>03 | 这些你必须应该具备的思维模式</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/03.原理篇·内容推荐">03.原理篇·内容推荐</a><ul><li><a href="/blog-architect/推荐系统三十六式/03.原理篇·内容推荐/01"><span>04 | 画鬼容易画人难：用户画像的“能”和“不能”</span></a></li><li><a href="/blog-architect/推荐系统三十六式/03.原理篇·内容推荐/02"><span>05 | 从文本到用户画像有多远</span></a></li><li><a href="/blog-architect/推荐系统三十六式/03.原理篇·内容推荐/03"><span>06 | 超越标签的内容推荐系统</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/04.原理篇·近邻推荐">04.原理篇·近邻推荐</a><ul><li><a href="/blog-architect/推荐系统三十六式/04.原理篇·近邻推荐/01"><span>07 | 人以群分，你是什么人就看到什么世界</span></a></li><li><a href="/blog-architect/推荐系统三十六式/04.原理篇·近邻推荐/02"><span>08 | 解密“看了又看”和“买了又买”</span></a></li><li><a href="/blog-architect/推荐系统三十六式/04.原理篇·近邻推荐/03"><span>09 | 协同过滤中的相似度计算方法有哪些</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/05.原理篇·矩阵分解">05.原理篇·矩阵分解</a><ul><li><a href="/blog-architect/推荐系统三十六式/05.原理篇·矩阵分解/01"><span>10 | 那些在Netflix Prize中大放异彩的推荐算法</span></a></li><li><a href="/blog-architect/推荐系统三十六式/05.原理篇·矩阵分解/02"><span>11 | Facebook是怎么为十亿人互相推荐好友的</span></a></li><li><a href="/blog-architect/推荐系统三十六式/05.原理篇·矩阵分解/03"><span>12 | 如果关注排序效果，那么这个模型可以帮到你</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/06.原理篇·模型融合">06.原理篇·模型融合</a><ul><li><a href="/blog-architect/推荐系统三十六式/06.原理篇·模型融合/01"><span>13 | 经典模型融合办法：线性模型和树模型的组合拳</span></a></li><li><a href="/blog-architect/推荐系统三十六式/06.原理篇·模型融合/02"><span>14 | 一网打尽协同过滤、矩阵分解和线性模型</span></a></li><li><a href="/blog-architect/推荐系统三十六式/06.原理篇·模型融合/03"><span>15 | 深度和宽度兼具的融合模型 Wide and Deep</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/07.原理篇·mab问题">07.原理篇·MAB问题</a><ul><li><a href="/blog-architect/推荐系统三十六式/07.原理篇·mab问题/01"><span>16 | 简单却有效的Bandit算法</span></a></li><li><a href="/blog-architect/推荐系统三十六式/07.原理篇·mab问题/02"><span>17 | 结合上下文信息的Bandit算法</span></a></li><li><a href="/blog-architect/推荐系统三十六式/07.原理篇·mab问题/03"><span>18 | 如何将Bandit算法与协同过滤结合使用</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/08.原理篇·深度学习">08.原理篇·深度学习</a><ul><li><a href="/blog-architect/推荐系统三十六式/08.原理篇·深度学习/01"><span>19 | 深度学习在推荐系统中的应用有哪些?</span></a></li><li><a href="/blog-architect/推荐系统三十六式/08.原理篇·深度学习/02"><span>20 | 用RNN构建个性化音乐播单</span></a></li></ul></li><li><a aria-current="page" class="active" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法">09.原理篇·其他应用算法</a><ul><li><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/01"><span>21 | 构建一个科学的排行榜体系</span></a></li><li><a aria-current="page" class="active" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02"><span>22 | 实用的加权采样算法</span></a></li><li><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/03"><span>23 | 推荐候选池的去重策略</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/10.工程篇·常见架构">10.工程篇·常见架构</a><ul><li><a href="/blog-architect/推荐系统三十六式/10.工程篇·常见架构/01"><span>24 | 典型的信息流架构是什么样的</span></a></li><li><a href="/blog-architect/推荐系统三十六式/10.工程篇·常见架构/02"><span>25 | Netflix个性化推荐架构</span></a></li><li><a href="/blog-architect/推荐系统三十六式/10.工程篇·常见架构/03"><span>26 | 总览推荐架构和搜索、广告的关系</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/11.工程篇·常见模块">11.工程篇·常见模块</a><ul><li><a href="/blog-architect/推荐系统三十六式/11.工程篇·常见模块/01"><span>27 | 巧妇难为无米之炊：数据采集关键要素</span></a></li><li><a href="/blog-architect/推荐系统三十六式/11.工程篇·常见模块/02"><span>28 | 让你的推荐系统反应更快：实时推荐</span></a></li><li><a href="/blog-architect/推荐系统三十六式/11.工程篇·常见模块/03"><span>29 | 让数据驱动落地，你需要一个实验平台</span></a></li><li><a href="/blog-architect/推荐系统三十六式/11.工程篇·常见模块/04"><span>30 | 推荐系统服务化、存储选型及API设计</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/12.工程篇·效果保证">12.工程篇·效果保证</a><ul><li><a href="/blog-architect/推荐系统三十六式/12.工程篇·效果保证/01"><span>31 | 推荐系统的测试方法及常用指标介绍</span></a></li><li><a href="/blog-architect/推荐系统三十六式/12.工程篇·效果保证/02"><span>32 | 道高一尺魔高一丈：推荐系统的攻防</span></a></li><li><a href="/blog-architect/推荐系统三十六式/12.工程篇·效果保证/03"><span>33 | 和推荐系统有关的开源工具及框架介绍</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/13.产品篇">13.产品篇</a><ul><li><a href="/blog-architect/推荐系统三十六式/13.产品篇/01"><span>34 | 推荐系统在互联网产品商业链条中的地位</span></a></li><li><a href="/blog-architect/推荐系统三十六式/13.产品篇/02"><span>35 | 说说信息流的前世今生</span></a></li><li><a href="/blog-architect/推荐系统三十六式/13.产品篇/03"><span>36 | 组建推荐团队及工程师的学习路径</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/14.结束语与参考阅读">14.结束语与参考阅读</a><ul><li><a href="/blog-architect/推荐系统三十六式/14.结束语与参考阅读/01"><span>加餐 | 推荐系统的参考阅读</span></a></li><li><a href="/blog-architect/推荐系统三十六式/14.结束语与参考阅读/02"><span>结束语 | 遇“荐”之后，江湖再见</span></a></li><li><a href="/blog-architect/推荐系统三十六式/14.结束语与参考阅读/03"><span>结课测试 | 推荐系统的这些知识，你都掌握了吗？</span></a></li></ul></li><li><a href="/blog-architect/推荐系统三十六式/summary">推荐系统三十六式</a></li></ul></div></div><ul role="slug-list" class="__dumi-default-layout-toc"><li title="一些场景" data-depth="2"><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#一些场景"><span>一些场景</span></a></li><li title="加权采样" data-depth="2"><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#加权采样"><span>加权采样</span></a></li><li title="1.有限数据集" data-depth="3"><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#1有限数据集"><span>1.有限数据集</span></a></li><li title="2.无限数据集" data-depth="3"><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#2无限数据集"><span>2.无限数据集</span></a></li><li title="总结" data-depth="2"><a href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#总结"><span>总结</span></a></li></ul><div class="__dumi-default-layout-content"><div class="markdown"><h1 id="22--实用的加权采样算法"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#22--实用的加权采样算法"><span class="icon icon-link"></span></a>22 | 实用的加权采样算法</h1><p>今天来讲一个非常轻松的话题，这个话题看似和推荐系统没什么关系，但肯定有用，只是在别的推荐系统相关话题里都没人会提。</p><h2 id="一些场景"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#一些场景"><span class="icon icon-link"></span></a>一些场景</h2><p>还记得前面讲到的用户画像吗？想象一个场景：你经过辛辛苦苦抓数据，清洗数据，收集用户行为，目的就是给用户计算兴趣标签。</p><p>这时候你可能会遇到一个两难的问题：如果给用户计算出兴趣标签的权重了，那应该保留多少标签呢？</p><p>保留太多的话，每次召回候选集时，计算复杂度可不低，只保留少部分吧，那真是手心手背都是肉，生怕丢弃的标签才是用户的真爱。</p><p>怎么办？这时候，你需要的一个简单的加权采样算法，每次召回时并不使用全部用户标签，而是按照权重采样一部分标签来使用，这样做的好处当然很明显：</p><ol><li>大大减少召回时的计算复杂度；</li><li>可以保留更多的用户标签；</li><li>每次召回计算时还能有所变化；</li><li>虽然有变化，但是依然受标签的权重相对大小约束。</li></ol><p>加权采样的应用不只这一个地方，比如在热门排行榜展示时，也可以用加权采样，而不仅仅按照排行榜分数顺序展示，采用加权采样的展示方法，会让排行榜每次刷新都略有变化，人民群众也会更加喜闻乐见。</p><p>下面介绍几种常用的加权采样算法及其原理，供你日常随手拿来使用。</p><h2 id="加权采样"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#加权采样"><span class="icon icon-link"></span></a>加权采样</h2><p>加权采样有两种情况，一种是能够已知全部样本的个数。这需要遍历整个样本，比如说用户标签采样输出，那么每次采样时仍然需要遍历所有的标签，来依次决定每一个标签输出的概率。</p><p>另一种是不知道总量样本是多大，或者总量很大，以至于你不愿意全部遍历之后再输出采样结果，这样的数据就是数据流，对应的就是流采样。</p><p>下面分别讲这两种采样方法。</p><h3 id="1有限数据集"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#1有限数据集"><span class="icon icon-link"></span></a>1.有限数据集</h3><p>等概率采样的方法非常简单，任意编程语言中都有伪随机数实现，就不在本文讨论范围内了。</p><p>现在假设你有用户标签若干，每一个标签都有个权重w，权重高低反映了用户对这个标签的感兴趣程度高低。你希望每次输出一部分标签用于召回推荐候选集，每次输出时都不一样，但是又能反映用户标签的权重，输出的概率和权重成正比。</p><p>这时候你需要一个公式：</p><p>$$S_<!-- -->{<!-- -->i<!-- -->}<!-- --> = R^<!-- -->{<!-- -->\frac<!-- -->{<!-- -->1<!-- -->}<!-- -->{<!-- -->w_<!-- -->{<!-- -->i<!-- -->}<!-- -->}<!-- -->}<!-- -->$$</p><p>解释一下这个公式：</p><ol><li>wi 是每个样本的权重，比如用户标签权重；</li><li>R是遍历每个样本时产生的0到1之间的随机数；</li><li>Si就是每个样本的采样分数</li></ol><p>遍历之后，按照采样分数排序，输出前k个结果就是你得到的采样结果。可以编程简单做个模拟，比如下面有这样几个简单样本。</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAARAAAAFUCAIAAABjofQ4AAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAABb3JOVAHPoneaAAAlIklEQVR42u3cfVAb570v8F8vmVXCeH19ZzX4Wly3yM6xGF9HoVMzuTY+9EBepPT6oHBjyz3xSwp2GoN7DfEtuAngvBjSBvc44Kmxkzpym5j0GOh1RNIGkhQaGpHjg3OLldSDOInluS5yzWjnuqwHVzthfP+QdiWBBHp4iV74foY/VtpltXpW332eZ/fZ/drt27cJAGLzH+K9AQDJBIEBYIDAADBAYAAYIDAADBAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8Dgjtn92+XLl+O95QDzYNWqVUzLo4YBYDDLGsaPNZ0QO38djhJeOLNrJaGGAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADBAYAAYIDACDOT1maUG5uxtr24e0S8k7ll1/rFqfHj57XOzpaHntau7pGjMXPke6YCvY+1HlC2WFf3+vjudi/0SF3HOkyn6NJ/Jo76us22aMd0ksHLmrYe8bbtKQz7d85+kG8ywKa/YmSJ6QfT4fyZIk+XzjkleSxBvS2HWv97rHc+2itLayeU9uvItossQNDN0Ycg06XUREJIXP8fS2FFXZiIjIfuqB3PL7hNC5A+daiKjpUFkTUeXr/TvWMv8MvC6HY5CIiP7irNxm5ONdEgtnzO10+b/pmjEfkVJSsueqN/aVaFfqJhex7Ok61zNGnOy7Kct/+9v/uynKPt+4V7ouSeO+kRtecVSceb19Z9y7cvVfaYhnlsCBoeAPVTNpxnKtOm3b9/LD5+v1acpraeC1bnVmXm7WbMo75OM4zSz+P3loIk6PD1UVl7piXYdg6+s2Tqr/Oc3lI022uW6d4zWHp75AF+9CCpPIgYmKX2s9UWIvO+3fp12HW3fadhn8s9x/sKt72rB/tyF9Vh+wyN2h0RLFHJjMSMcU4d5ionMMnylkCFpdpna5Tpu+VFiu0wrapcs4QZ9wtXtSBoaIcvcdsf6mqG2UKENwHmtxb2/WpxGR58yhLmWRvEPfnXP3Y3Hm7UsfQ4MsCmNxfeXdPi2voTSOv0vDpXMazVI+naM0zVJeajFtt/uXW1Pd/6Y1wZpd00mKwPh86qQsOj4YkIjoLm5slIiIRkWiIUd3lyuNfFfftYf8m9vR5b5FPuI2mQoFf5ttQna73KSZfgd5nR5lcvzKxS/c2mmXln2kM+j5NEpGvvDpQLmk6ytrSmsbbEo/w1J/JI9kWV2S48ZeqmpU5oZXArLb9nzTZeI1y5YK6UvGvEREN8dvTvrYoQwi/+4btr/Q4PLXUb7xwGxNyHHKN+7T6B8+uCcvQUL1tdu3b8/i3xbqUdmyq2LjdkcGCSRM6hcKRGJ+fee+saJtjYwrNdj6WgON7HHn9vzYW+cxitSIn7MFKmH3uYqtDQ6BBJFIyBDF0ZB5GYIwSiKJxr022x6jfc/6w4NERJRff+GoOXw10pnHCpqGiYhoTWXvmzuCoRl3leZvd85zYYTswfkzuxJOuOswEhGN0tSzKIHXaUvZV6kJNrLv0GjZ/38mmcl0YkAmIhJJJApPCxGNiiKJROTsGZKJNMuV94c8k3fGuLtnODAp5BkSrp+xkJKiSaYY89HELP7NF9rwmHvrfPr1JzwpxuUMRiN1O4mIRj8aGS8VQg7w8hWnWodsWpsZ9m8a3rq/vJA4jueXhjf51CU0mrF3f9boUOJaWlO/KnIZaojGJEmWSatNmN9pwmxIAJe9xkDpGp5oaNCpHtgMOUYN+fj/ptOuzu3tLQz9B41Gc/H1vWUnA3uw/Hjnjnt4X3iueHVnc4Yjr59we+Wpn8uli2V7a6NvmKH+ZKUwLssRZnH6JKpi+GzDGn8ngSfyOgeD7VMhJy+TJCIf6ZcSkXb1JiJ/qTqHrsnG1cFOhPtCjzqde3d4nZ2mM+8qJSLpiwGHS9RE6tpx3NJgpbTGvGoZRzJFLEL+7octqxOrAkuwwHD66jdbiYjGnaX5pUpgjIdabAZlf3H85BLUhrzD8VounZumg6hbmxv5xL7oMEx7LpXX5+YKlOz036lu/U5gWrpgK9irfOOM0jdPlYd+P06XJSgtYYdzxLpar8yRHF1qBWM26CIXtsfRVHssht7icFdtVVe0mYa9rXmrDfEuszAJ14fx8/zBHtJxdG7/kX2aloQmNDCzPNjLXQ0V/t1r2FZdaVJ+OabK+hL/uWlXRYNdnt26E5T87smW4KtRm2nPGU9ozbw8e5My6Wh3BMvf42hROjBk2qSPcnqQm4/eoiZBTo2FSLAaJkDq+aU97I2+w1saNG/XmDki2TNwqnXgzv90p38Ox/2t6VjwENVlO3VTf6fy6m9en3bHE1bdTOUufdpW2xeY3vnd++ll5UTcdW3egd3C6QqRiPoOnzpfWH5fYrUQZu9qT+Ng+DuDTUU75c43SwM1cJqusFiwnxOJiIbfGPDsKNQREbk+aFP/w2qKYaxXRl7lE4WcHOykaDi55+dNSh9GKK0q1wY7OxryuV471hbDyJn4SMTAyFcdTcOT3xTP1e5dqbPtMtINl+1s1FEXzm5b+DlNg7lkpsBMeJpKmgLTa6oLV/Lvjimzxsc0gvmgiaq7iYhs+2rv7282JN5hbxYc//JyhHeHW4r2cL2nAqeJc4t30jl/yYhn/uAq3GagCU/bMbWAjeb1MTRSl92bV1AYVt2kSWK7Gpj7HzaFz5W0XQgMk4GI+5LIeay0Mau78utMx3jNjG00x9EStTqrrH2Em3Jup/BAo9BdLRIRObb/qKv/6Fc7qnchiI4Xzkb5TQ42FdRoexvMPBFnKLRQk79wnEfaPNvq+AtvBav+4h0xXRsZbtn6QEv02W1bH2iLYS2JIvH6MDcGXjgrUkbkmW0nf8d6Xnj6c76e3sYK9aeTU2ddy9GUsZ4kFNbvVbqefbV7Tw3Eu4zmqufkCyJRoHZQijpYWXTXVpx1ExGl6Sz71eFF9rd6B+w/D9bt1cWbYvioVJNwNYzj57X+fRlyADTXN+hqa2xEZN27SZelu9BvIbWvmUau10u3K+2E0uPd5fcJYZdrog9akS6cKapSD29C4wuWaFVHbkm9+eRWf1fJebKsVmitL06sszexky+1VZ8TSS1hf9Mov/70Pl/RtsNERGQsMwXOiRn/+w7hmL92JVtVWXAtGeX3x3rfhJBnyg1vFUjubod6Bk3IN+feFTLzlqerb76HCsyfxAqM/EWb/3gvjgp5OVpH4CqBZHhgT323rXasvjJfRxS8b8OP0wR3x1L/GbMYRnZJl+wFe5vUl3lVJwunGUiepj90tq4r8HuirobtGk173Xf0lHRk90u7Aqc0hOLKneNvNHWLRER/GdOutp4oaSs77bIcqc9dpiwvbHrKRLXdk1djqTLHeo59ze76BuukwLS5Cxr93dSc6rePhg++HHe653/40rxJpMBIzip1nFjxUzu++ZEaGHmCMz/faaQovfeQd2M8rSxdshfsOhx8nVNXvy346484JJFbbWmvGdjaEDgjZz+01edLunpGavvRVrUT8tT2QjrWFDo794n60nHXzrBbULjCJ+qpe9IlXevu/JhvUxluLFgfffjfYOPG9ayDA+MpoQLjdSiTdbsKMy+8G5z1JRGv00147MffEjV3hv4Tx5G7b0h92fUvp+SVd066IP83n/DIExY1bZ4+W9GBkG5ohrXzlCXkEMgtVQespYedM9AX1zd7PBWnAw2GrobtHvHEyT25SXMOYNxtV86e05rKwixt8Hxg4Kvry6smV5tclrkuo/ZwyMAzy9HduuQcnT13iRQYXWF7Td7WBgfl1D28khvpn7KAT7Kftk3fvHWei7iAYVOJPzDywOtVZcccYTNHfR+9brupZIyjkSb1VzVoP3VKDAkoR+MjYR93smzjperOn8x8qSchpGfvVNpX5U9buJnOiATcGLCHD9McuuKl/JlaZPNRID454YbpJVJgiPTFh0obTKuefThyad9Bs71qqCEiklyN27a3he17oe74wYF91Y3Hov2j03ZycgArjzZ7flIRXE9fY9FGZ3t/faLdfR4Jl/fdSupuopzqrffwRPLMDVjZffiBsklF4Dq23WboLr1vuszoi5v7TZGHRnB3eG2PFLX4C3BNZfcvrPyXUdZyR8KVaWIFhkgov3Ah6swvYx5qO0lGtlZDNO4bCj9Slp/ssKz39jCujMvMre6wjeSXBuup/Fxtwu3ZyPh7Cs3UtOnZR2I79Hhs39tqjzSjZZ9J19FvjvzIBNl+4B8PD9E0eQreWTDc9Ngj70YfRC6K2XX9Ry2JU7qJFphppRtO9k9uqHEc53y9tFQ5rWw93lm9XitPugsgjePSiHjjkaNW04HAeeTq093We3gad7Ne2Lk57qN0Y/MHJyoeKHMQEVnaf2JJngEzukO9/VxMT58Sz+wpagkZciHk5GkHg6eDa7eU8J2n8yI1Rn1jIo1SjFfrxdFpT4kt8/nmp303P5IqMERcpIHIfMhpZR2vDcQjEiG/si6n7fCgsbHjZKH/6JhuPN3bG9JS1mjSvG37i5oGiYhoTWXnKat2IuxuDU06T0S0LLe5t/XwtpdyXzmYDI2xkDKMJS2yu+V7W22hA5TWlHecKtVc6dq4RT1j5qooKmmOkBmf7Jn5E2KXUDdPJFlgYjD98YizvNydS4Iu9KQYP+kXpA3OTOe06RxHUe4X4A11v53zs4QSj+wZqCoqCz8xYm3/RSlPRFnmzqOXiw6o39pVUfSP9a93mNeGVrG89WyvZZpb/dKk9ifVusvc3ntQG31hDT+bZzEunNQLzEx4geFBV+OxL5oaZFf3qe01k44Clva+arUW1eWXt9d41OtRRGLtrgJnQ2u1yUBEnl7bSx+MZC6bvlbwXVTrrgzPmZMnplta9vnGfZkP7C4tSIjLxIsvMDCNK+9OTktGaftb5ZPanPriepsslR4JVkJtNduz7u63ruZ8ox85ulkGtow67WdnXt5g2Fka77LxS7zBlwkl1Z9LFuyb+b9plqW9Jk99TzDV9f62PGIPzbitubUm+CgZ4/4T1tUcESXehZN5lrg1jBx8mtwMT5kIWZLk2TwlYzJJ7bN65IQ6RTPvgs/gUb6pvvhI/YWNtd1U2tBabppu4I+huL5TWFV0oIVM9Sd3Be4k47PM1m3rl8zvgWb8pjYrUU5DJthzyULIott9nTiNTGl8ZtZ0V9Klq66h62NERBOUuTZXN+eyFa+4vRPEkSynaQ1Z8bmR/ysoYSIiWRIlmYgojROWKQU3IYmSRlgW04FC9nh8y3XJ+BzD2ZVw4tYwnKA3xPZb5VcaclfO50cLWfrkf9xFbDhemPpV03hhWcwr0CXHqKD5gj4MAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADBAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8BgTvf0+x8jAAsHJZxoUMMAMJhTDbPgDwFaxL6ixywtYrOrvVHDADBAYAAYIDAADBAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAYE7PJYMUJ8ui5PX5iIh4Xsvz3HyuWxK9ko9Io9UJ87neBYbAQATSFz0njr/W1ucKezfDWFlRaTUZ5+H3LbuqCrY7iIgEW1+3MT3eXzhmaJLBZM6ztQXbqienhYhGnU01pRv3nPFMzPET5K7n/WkhokxNvL8vEwQGwojnW0qPdAVfZxgt26zmHCH4zmBT0aGeuXyEp7eptjve33O20CSDEBOeln029VXpkfbyAj0REVUfujpQVVwWqBa6q+1P9FuyZtU0uzFQVdUW7+85e6hhIEi61GNXps0vqGkhIuJW5jZ3NqoVTUv7xdl9wpnyMtes/jNBpH5gJI/HdWHA0dvT09vjOD/gvOT2iFK8NypBDZ1/V5k07zbpJ8/WFR4qDkRGPNvrYV+/+1xt0zARkXFvfbVJYF9B/KVyk8zd13b4QKMz4rwc64mXKnOT6XzmV0B2/6ty9C8u1KdFWMJostA5f5ttyDtOOpazW/KVrq0N/jad9ciewoE9tfH+vrORsjXMwKnSrdHSQkSDbWWmKidqmjBer1JrmL+pj7gEr8tW6gXn0DWZZeWepi2BhNSdrRSIxuL9bWcnNWsY6YKt7GQwLHnF5Q9vNHAkSVedbcfalKOo46VzrtZdhnhvbMIYly6MBiaNhszIy2j12UT+akL2+YhiraIHjgd6+ob9NstqjkhOrrPJqpQMjOw416JMm20f1BuXqbPMlu9ubfneVtswEZH3qpcIgVHcQbwyGT0MTLVKgPTpmbLTLiKijNIju4zx/p5zkpJNMp/3j4Epy9GnQtJCRESc/mFzICTin9xolAV9SWppcBSlAuD0eTmMqx131ZY0+SfrX9mji/e3nKNUrGEmJO13K6s1nOwjw3/lp873XlcnuSRtGCyIOzgdkb8h67guWddGPovFWGJyV0Pgor6xqtW8MunPsqRiYNJ05l07Jr0nS5JX9I78X1fvWy+39Ynx3sSE9KWsninOW85HXmZixDnIsMrgRf2M8uZtqdD6TcXAKMQrzoE/Xhj4w+/sfUl9reyrEtqHoSh9GJ/sjn2FonpR39D8RmmUCPLJ9RtMqo2N3bjbtn9ry2C8NyO5hPZhNFFaXiGhmonc1aBc1Dft1JPHczVkZppXqamG3J97eJ58pMlcmQTXxVIxMBMe25atLaPqa8FSsjN3rV63XKddrtUJvPtc7daGrjl8QIrS8HqlD+P63EurI/XPfWNeZZKbqTszpl5q6a4tijraUqzdVeSfqj7bb12d6JFJwcBIl7rUtBhLGpv3FU4+KMo4NxZJmtaQQzRIRDR01UsUITDyVZfSujVmzzD40iePs30+04WdeEnBwHgufaRMWuunpoVI9iEwEXF6g4EGXUTkOmn3lBh1U0bHXPyNOthMr52hguELK+o8fSNLIg2fuZNufvSbNucoEQnmbRZdOt0cJz2fBOcsUzAwnNrMzjFop86WBl46FhwEkATHtK9Qdn4enfVXIfbXPthdZwqvZG44as+qg83ywuI0LqtXNLn0QInq7rNU3xf1s4Q/+gOTvftAecRxa4kpJS9cKgYPnzkfNqZWuuKoKCgLxiVdE3MXdlHgv/mwWZm215TYPw05/37D1fhYhfq6sjg3OEt2V+Rv3Bj4K3HG1BJT8yVJvnh/bRYpWMNkrs9ThjtRy76i3+Vb7s/Rc/LYQI/dMRx+BWbw8Pr1PfWv15vXIjhERMTpyxssXTX+m2LEwyWmNpMlm0jQ+WynQ06T5NRZw0ostFOoYW1XJUE7LEQKBoZb/Ui9qVG9CdbVZ3f1hS1gyCBX8Bya441+t3ltcg9wmkc608Hmz4cqTgeaXq5u++RrWBnW9mOWSe3Y0PQkVYXBLCWbZJy5obe5yjJ1hiHf2ny2t/W3vdU5wTc1ydDX/Apxefta249X52VMnSVY9jf2vl2tn+Y2mIz1WrZHwCRZ3f6127dvz+LfLl++TESrVq2K9/ZPa0KWrnu9t3xERJxGK+j44L6UPVdGpHHilmn1ukTcZ4lQwrIkesUx3wQRkWaZVivM64PJ4m12JZyCTbKgNI7XRUsDp8vSs61t8eF4Qccn5Y3ECyclm2QACwWBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADBAYAAYIDAADBAaAwZwe5Od/diAsHJRwokENA8BgTjVMZmZmvLc/ZY2MjBBKeCH5S5gVahgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADBAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABjM6blkienmnz9zXfMRkbDqniyBi/fmJDNZFiVRlomIeF5YsmSeCvOmeE2SiThhRfLtnhQMjKfvn/cfHyYiYc8rnSXr4r05Senm5Q9fPfmLXzuGw97NWPeD8v/56IPr5vgr/+RMyf43RCLhlQ86190V76/KKAWbZBwn+CdWaJLu+JUQPut43rTzmclpIaLRz3723JMFZb+6NjGHtctXfvWGSEREK5Jx96RgYGAuxIFXn3z5veDrjHWbtzz6kFEIvuP82ZbDH85y7RPiryq2fxzv7zgXKdgkg9mbuPZq5S/VV4+/2Pr9b2cREdGBp//8yTPb9gd+6+8/805J7+ZvxFZDTMiyTPK46Po/v3/1uZ99Fu+vOEcIDATdHPr9O8r0Q3VqWoiIuP/yrZ92vFi05Rl/c+rV//3p5qe+NfMa5eEnC0qSPSShFkOTTBb/fOUTx4fvvf/eex9++Mmfrty8Fe8tSlSuf1MbYw89/mDW5Nkrvv10UaBtJnZ8eC2WNc6lt5OQUrmG4ZfQtT/9+pnvH53Se6V1RQee2//oimQ7RbPA5Cv/phRV0T9kpUVY4p4HN1Onv83mEm/RzAWYxm188KGsu0Iab7fEd95P4l5MKgfm45dKtkSZ9Vnn0S2dHx/r/Om3BKZVpjZR/Etg6qF7vxFxiSUrDAKRSET0meuavG7VTN0YLuvx554Ne2fiivj+x8mbmMXQJCPK2PCDg8/+tPHFA3s2hwTk4/1FP76Scm2G2bslfTIamFy3Rhd5GeEba5RJ2X9Fk9XErP4rYaR+YB46+Irj3E//qeihDXnffrTk6c7ejgN56sx3fnzuSrw3MGGkEa9MRg9Dcv/c5y7FA7Nm57Fni8Iv9nMrHm3seDwj8Oqzl+d2GS6VTJCkTHIUpa3FZW0wxns74yq1A7PuBzsinvpc8dgzjyvT7/z+3xf7UTMgjVPbYR9fl6ItpYn3ZsZXSgfmwUfvWRJ5zpJ7/2GDMi1JUqwrTG0TskeZ3LCcj7KM51NnvLczrlI5MOvWrYl6EiekafHxv4vx3tLEENqHidZXkeUr8d7M+ErlwNB0p3FkUTlSJuMQwAUR2ofhopRKSKgWp5QOzHRR4HRKDYMeTADHZymTw19EqXVlSZ3BLcpDTSoH5rPfDUcNw63ht5UaZsPf4eIlERGlCWuUg8jwnyMHRv7zsDIWYJ0hxsGXqSWVA0POVz/5a+Q5Nz/rV0cE8vwib2WouKw1gcuSw6fejni2/dN31cFmi/Rm1pQODIk/fPm9SJXMtVdfVAexb97wd4tyz0di2KSeO3znFz1TRlf+9ePnO9TBZhtXhA42uyXLyl+8v8TCSu3AEL3//JMvvyeG7sRb135VveXX6hiQp/4p4ijDxWnJvQ89pEy/89yT7/wppGH21+Gj3/uh+voHlpALXPKVHz5QUBD4e/KzlB4MnsqDL/2GO54v6nh+w5bHN6wUxC8+/mVn6MC/R58rzor3BiYSLuv7z21+7zn/TTHij79f9OsHN68hEv6z/Ms3Qm7DND79aHboFS455EoWl9r1dUoGRt19gkCi/6D4cccvp4yQfeiV7gMrUL2EW/Hg//rpF8M/fCPQ9Bp+/53JN0dkPNp6dPOkVIT2AmNvkyVj6y0Fm2SaJVn+iQ0Hj3V+0PqDoqkPjhE273uxs+/ZdUvY1rw4cBv2nm5tOrAhY+osYfO+F7s7DmRNcxtMxreEWO8y0i1JwqPV127fvj2Lf7t8+TIRZWZmxnv7YzMhi6OidMtHRJr/qBWE+XrA1gIaGRmheJewfFMURck3QZQ85RY7fwmvWrWK6b9Sskk2RRonrFiBqy2suCXCiiUotjAp2CQDWDgIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADOb0ID//swNh4aCEEw1qGAAGc6phWJ9LC7HzP70aJbxw/CXMCjUMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADBAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAM5vRcMkhxsixKXp+PiIjntTzPxXuD4g+BgQikL3pOHH+trc8V9m6GsbKi0moysuVmwtO4s+QiaaMucMOb/cSxumJDvL90TBAYmMx5trb0SFeEGaPOpprSpvbKzld26NJiXt34yMVh0UXiNIu42gcqiw18vL94LNCHgTDi+ZawtGQYLdus5hwh+M5gU9GhnthXKI+6XbEvnfBQw0CICU/LPpv6qvRIe3mBnoiIqg9dHagqLnP4Z3RX25/ot2TF1DQbcTr9E4a9J1r35MqyHGkpLlm6R6hhIEi61GNXps0vqGkhIuJW5jZ3NqoVTUv7xRjX6fnc7Z+4/75sIuIii/c3j9kiqGFkyf35kOe6JMnE3cVrtdrMlZkCTvhEMnT+XWXSvNuknzxbV3ioWKg4JxKReLbXU5Wrm3mVkvuP/haZkCUkRSdlBikdGNnT1fxS7VnH1DkGU+Whqh2GZfHewsQiu/9V6W4UF+ojdeuNJgud87fZhrzjpEufcZWegWH/VK5eO9PCySB1A3NjoOKBMkeUma7upu3db9R3vG2OrSG+OHi9nsCU+Zv6iEvwumyB/Ce8nEPXZOPqGUpPvu4O7IL8TZkciVdcl90joixzHK/9ul6/Upd0NX2KBmbCfTgsLQbrfuv6LB3ddNl/1uQY9b8p1m55ydBfp0+2fbZQxqULgZIhoyEz8jJafTaRv2Bln49ohrLzXVci2Fe797Fa5/DkBcx7Gw/uKUyitlpqdvrdHU1q51Uoru8931q9y1KYn1v4nR3Nv+0/sT9PmWl/rdczu49IQXeQ+sOV/Zf3I5BjXJmf94uP1OmpaSGirpPVBd9pdLOtNZ5SMTAT7jNHlNplTWVHjZkPa45zubsOlSovurqdybOzFtiXJCmTHGkiL8Pp83JiX6PsOu8MfZ23rbLx6Inmhjprfsh1/dG2rT/qSpa9kIJNMvnKgFq9lD9tiVTdC480lLv6LvNEq/INaJEF3MHpiPw/cMd1ybpWiLiUJvYVTngH+pTpNaXtr5TrlZ2RZ7KUfdG1d1tt4CRDX+1bXxRaZ+oRJYIUDIx35IoyaS6IMt5CZyptNsV7QxPNl7LaPM1bHqVbMTHiHIx9jbz5SH3uLd+YpNm0xTxpNA2/2ny6gzZuqfW/bDze88hRc+InJgUDI10bCkzlGDMTfw8kjtA+DEXp0Ptkd+wrTONzC8zTzOeyzI3FL1efE4mIxsbi/f1jkoJ9GE7d7+Pkm9OaFpnQPowmSssrJFTz4t6/vz8wNegcSYZ+TAoGhtT9ns7S4AYNr158cX3ujbyMb0ydwc1H6fJfV3v/HunLeJdADFKwSUa80ncddI7I1oiXWeSrA23dLuKIeIO1OBcNNyKiNK0hh2iQiGjoqpcowsAX+apLGQtgzJ7pmq981XHqdcdNzqdbv3tHQeRhNN5LA8qkjk+GH2MybCOjTIORyD9AvavXdVB/T4RGxMXO2qbTIhFRRqUFgQng9AYDDbqIyHXS7ikxTr3p5eJv1MFmeu1MFYy7u8V2zkVE1Ku3FOyI1JaTnQ4lMGuSo8OZgk0ybkW2emGy5WB7hBuXJtz204G3Df/DmESXmRdadn7IJd0PplzSveGoPasONssLi9O4LCt/6nu6HKV/MtrUfl6a+nHypbdqu5UdkZccIy5SMDCUbty9V2kZj7aYato8ob1JyW2r2qveIbXTlB3vzU0g/DcfVs9q2WtK7J+GHG1uuBofq1BfVxbnBmfJ7or8jRsDfyXOcWVtd9+jdlBa9m05cz4sgeKnXSW7GpVXhsrtuZQMvnb79u1Z/Nvly5eJaNWqVfHe/ihkd8XGraEjL83byo13L/FectjOBd8Wtp3orkrQ/RSvEvZ0Hy6qUS/8ksFkySYSdD7b6ZDbMHPq+k9ZghWC7CrduF25pG9s7bMZ0tW11RbVhN6/mWct0I7JGnL/rmswmMa8mvbm4sjDPRfO7Eo4BfswREScvrn7RIUpOP6y62zL5LvU86vfTNS0xJHOdLD586GK04Gml6vbPvkG4wxr+zHLpOZTaLPWF7a2QyeuS2XHlP0w6mg7O/kTzTWt9V95WmYtFZtkfkJuc393435LhAEeGcbqo+0XjloF9rUuAlzevtb249V5GVNnCZb9jb1vV+unuQ0mY702bC6Xu6u592xz2OAxhdFUeqKjtz5Jnhfjl6JNsnCS6PHe8BHJso/jl2t1yXDrXyKUsCyJXnHMN0FEpFmm1c7xPtVxySN6ff7+JLc0c7kQ3zuT0SSLihd0PGoTdtz8Flw6r0tPgkPV9FK3SQawABAYAAYIDAADBAaAAQIDwACBAWCAwAAwQGAAGCAwAAwQGAAGCAwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYzOlBfv5nB8LCQQknGtQwAAxm+WxlgMUJNQwAAwQGgAECA8AAgQFggMAAMEBgABggMAAMEBgABggMAAMEBoABAgPAAIEBYIDAADBAYAAYIDAADP4/y5OaNruqR6AAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjMtMDktMjlUMDk6MjQ6NTYrMDA6MDAfwuB7AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIzLTA5LTI5VDA5OjI0OjU2KzAwOjAwbp9YxwAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyMy0wOS0yOVQwOToyNDo1NiswMDowMDmKeRgAAAAASUVORK5CYII=" alt=""/></p><p>模拟10000次后，三个样本被采样次数如下：</p><p><img src="/blog-architect/static/httpsstatic001geekbangorgresourceimagedc27dc701147b5785fd40ad7205364feeb27.738e5e1e.png" alt=""/></p><p>你可以看到，每个样本采样概率和它的权重成正比。</p><p>还有另一种加权采样方法，是利用指数分布。</p><p>我先给忘记了指数分布的人复习一下什么是指数分布。</p><p>假设你到银行去办业务，每个人办理业务的时间是不确定的，那每个人办理业务时间的概率分布就是指数分布，用教科书上的话说，就是两个事件发生的时间间隔。</p><p>指数分布的概率密度函数是：</p><p><img src="data:image/png;base64,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" alt=""/></p><p>指数分布的参数Lambda，它的倒数，$\frac<!-- -->{<!-- -->1<!-- -->}<!-- -->{<!-- -->\lambda<!-- -->}<!-- -->$ 就是事件发生时间间隔的期望。把指数分布的这个意义放进标签中来考虑，标签的权重其实反映一个直觉：权重越大的标签，用户消费它就越频繁，也就是间隔时间就会短。</p><p>所以根据这个原理，就有另一个加权采样的办法：为每一个标签构造一个指数分布随机数，这个指数分布的参数Lambda就是标签权重，然后用这个指数分布的产生一个随机数，再输出随机数最大的k个标签作为采样结果,是不是很完美？</p><p>还是上面的权重，再来模拟10000次。<br/><img src="/blog-architect/static/httpsstatic001geekbangorgresourceimage46df468fcee6b610b57649a62ad9904e75df.a51a7211.png" alt=""/></p><p>依然完美符合权重的相对大小。</p><h3 id="2无限数据集"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#2无限数据集"><span class="icon icon-link"></span></a>2.无限数据集</h3><p>上面的两种采样都是针对有限数据集的，也就是采样之前都要遍历一遍所有样本。那么如果面对的数据集无限大，或者不知道多大时，该怎么做加权采样呢？这就要讲到另一个采样算法了，名字叫蓄水池采样（也叫蓄水池抽样）。</p><p>蓄水池采样可以用在推荐系统的哪些地方呢？比如可以再模型融合之后加一层蓄水池抽样，或者在召回阶段加一层蓄水池采样，这样在不影响整个推荐流程和转化概率的前提下，降低计算复杂度和提升推荐多样性。</p><p>或者，在线阶段要使用用户的反馈行为做实时推荐，对于不同的用户，活跃程度不同，产生的反馈行为数量不同，你也可以用蓄水池采样，为每个用户取出固定数量的行为用于更新推荐结果。</p><p>下面，我先讲蓄水池采样，再讲加权蓄水池采样。</p><p>假如有一个数据集合，一共有n条，要从中采样取出k个，那么每个样本被选中的概率就是 $\frac<!-- -->{<!-- -->k<!-- -->}<!-- -->{<!-- -->n<!-- -->}<!-- -->$ 。蓄水池采样的做法是：</p><ol><li>直接先取出前k个样本留着，这k个就是随时准备最终要输出的；</li><li>从第k+1个开始，每个都以 $\frac<!-- -->{<!-- -->k<!-- -->}<!-- -->{<!-- -->n<!-- -->}<!-- -->$ 的概率去替换那留着的k个样本中的一个。</li></ol><p>这个过程，随时可以取用那个k个集合作为输出结果，任意时刻，当总样本遍历了n个时，他们的概率都是 $\frac<!-- -->{<!-- -->k<!-- -->}<!-- -->{<!-- -->n<!-- -->}<!-- -->$ 。这就是蓄水池采样，蓄水池采样，顾名思义，k个元素的样本集合就是个蓄水池，是任意时刻的采样结果，可以随时取用。</p><p>现在回到我们今天的主题来，实际上更需要的是加权蓄水池采样。加权蓄水池采样利用的依然是在前面说的第一种加权采样方法，只不过结合了蓄水池采样的思想。</p><p>要从大数据集中采样k个，其具体做法是这样的：</p><ol><li>为每一个样本生成一个分数，分数还是用这个公式 $S_<!-- -->{<!-- -->i<!-- -->}<!-- --> = R^<!-- -->{<!-- -->\frac<!-- -->{<!-- -->1<!-- -->}<!-- -->{<!-- -->w_<!-- -->{<!-- -->i<!-- -->}<!-- -->}<!-- -->}<!-- -->$;</li><li>如果结果不足k个，直接保存到结果中；</li><li>如果结果中已经有k个了，如果 $S_<!-- -->{<!-- -->i<!-- -->}<!-- -->$ 比已有的结果里最小那个分数大，就替换它。</li></ol><h2 id="总结"><a aria-hidden="true" tabindex="-1" href="/blog-architect/推荐系统三十六式/09.原理篇·其他应用算法/02#总结"><span class="icon icon-link"></span></a>总结</h2><p>今天介绍的算法非常简单，但是在推荐系统中有很多的用途。尤其是面对的数据需要采样、需要有所变化时，加权采样本质上来说就是让权重影响采样概率。</p><p>前面的几种加权采样算法，都是让采样概率和权重成正比，这意味着你的样本权重之间的关系要合理。</p><p>那么，请思考另一个问题，如果你的样本权重有正有负，该如何加权采样呢？欢迎留言一起讨论。</p><p>感谢你的收听，我们下次再见。</p><p><img src="/blog-architect/static/httpsstatic001geekbangorgresourceimage87b0873b086966136189db14874181823fb0.5a0b85fb.jpg" alt=""/></p></div><div class="__dumi-default-layout-footer-meta"><a target="_blank" rel="noopener noreferrer" href="https://github.com/GGwujun/blog/edit/master/ssrc/推荐系统三十六式/09.原理篇·其他应用算法/02.md">在 GitHub 上编辑此页<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="__dumi-default-external-link-icon"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><span data-updated-text="最后更新时间：">2023/9/29 14:47:35</span></div></div></div></div>
	<script>
  window.g_useSSR = true;
  window.g_initialProps = {};
	</script>

    <script>
      (function () {
        if (!location.port) {
          (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
              i[r] ||
              function () {
                (i[r].q = i[r].q || []).push(arguments);
              }),
              (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
          })(
            window,
            document,
            "script",
            "//www.google-analytics.com/analytics.js",
            "ga"
          );
          ga("create", "UA-149864185-1", "auto");
          ga("send", "pageview");
        }
      })();
    </script>
    <script src="/blog-architect/umi.ded6fefd.js"></script>
  </body>
</html>
